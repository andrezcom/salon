# üè≠ Sistema Completo de Proveedores y Cuentas por Pagar

## üìã **Descripci√≥n General**

El sistema de proveedores implementa una gesti√≥n completa de proveedores, m√∫ltiples costos por proveedor en productos, cuentas por pagar y √≥rdenes de compra. Permite manejar m√∫ltiples proveedores por producto con costos espec√≠ficos, t√©rminos comerciales y flujos de aprobaci√≥n.

## üéØ **Caracter√≠sticas Principales**

### ‚úÖ **Gesti√≥n de Proveedores:**

- **Informaci√≥n completa** del proveedor (contacto, direcci√≥n, fiscal)
- **T√©rminos comerciales** (pago, cr√©dito, descuentos)
- **Informaci√≥n bancaria** para pagos
- **Calificaci√≥n** y estado del proveedor
- **M√∫ltiples tipos** (manufacturer, distributor, wholesaler, retailer)

### ‚úÖ **M√∫ltiples Proveedores por Producto:**

- **Costos espec√≠ficos** por proveedor
- **Pedidos m√≠nimos** y tiempos de entrega
- **Proveedor preferido** por producto
- **Historial de compras** por proveedor
- **Notas espec√≠ficas** del proveedor

### ‚úÖ **Sistema de Cuentas por Pagar:**

- **Gesti√≥n de facturas** de proveedores
- **Estados de pago** (pending, partial, paid, overdue, cancelled)
- **Procesamiento de pagos** con referencias
- **Desglose de productos** en facturas
- **Documentos adjuntos**

### ‚úÖ **√ìrdenes de Compra:**

- **Flujo de aprobaci√≥n** (draft ‚Üí sent ‚Üí confirmed ‚Üí completed)
- **Seguimiento de entregas** (parciales y completas)
- **T√©rminos y condiciones** personalizables
- **Informaci√≥n de entrega** detallada

## üèóÔ∏è **Arquitectura del Sistema**

### üìä **Modelo Supplier:**

```typescript
interface ISupplier {
  businessId: string;
  name: string;
  code: string; // C√≥digo √∫nico
  type: "manufacturer" | "distributor" | "wholesaler" | "retailer";

  contact: {
    primaryContact: string;
    email: string;
    phone: string;
    mobile?: string;
    website?: string;
  };

  address: {
    street: string;
    city: string;
    state: string;
    zipCode: string;
    country: string;
  };

  taxInfo: {
    taxId: string;
    taxName: string;
    taxAddress?: string;
    taxExempt: boolean;
  };

  terms: {
    paymentTerms: number; // D√≠as de pago
    creditLimit: number;
    currency: string;
    discountPercentage?: number;
    latePaymentFee?: number;
  };

  banking: {
    bankName?: string;
    accountNumber?: string;
    accountType?: "checking" | "savings";
    routingNumber?: string;
    swiftCode?: string;
  };

  status: "active" | "inactive" | "suspended" | "blacklisted";
  rating: number; // 1-5
  notes?: string;
}
```

### üì¶ **Modelo Product (Actualizado):**

```typescript
interface IProduct {
  // ... campos existentes ...

  suppliers: Array<{
    supplierId: string; // Referencia al proveedor
    supplierName: string;
    costPrice: number; // Costo espec√≠fico
    minimumOrder: number; // Pedido m√≠nimo
    leadTime: number; // Tiempo de entrega en d√≠as
    isPreferred: boolean; // Proveedor preferido
    isActive: boolean;
    lastPurchaseDate?: Date;
    lastPurchasePrice?: number;
    notes?: string;
  }>;

  primarySupplier: {
    supplierId: string;
    supplierName: string;
    costPrice: number;
  };
}
```

### üí∞ **Modelo AccountsPayable:**

```typescript
interface IAccountsPayable {
  businessId: string;
  supplierId: string;
  supplierName: string;
  supplierCode: string;

  invoiceNumber: string;
  invoiceDate: Date;
  dueDate: Date;

  subtotal: number;
  taxAmount: number;
  discountAmount: number;
  totalAmount: number;
  paidAmount: number;
  balanceAmount: number;

  status: "pending" | "partial" | "paid" | "overdue" | "cancelled";
  paymentTerms: number;

  paymentMethod?: "cash" | "transfer" | "check" | "credit";
  paymentReference?: string;
  paymentDate?: Date;

  items: Array<{
    productId?: string;
    productName: string;
    description: string;
    quantity: number;
    unitPrice: number;
    totalPrice: number;
    category?: string;
  }>;

  attachments: Array<{
    filename: string;
    originalName: string;
    mimeType: string;
    size: number;
    uploadedAt: Date;
  }>;
}
```

### üìã **Modelo PurchaseOrder:**

```typescript
interface IPurchaseOrder {
  businessId: string;
  orderNumber: string; // N√∫mero √∫nico
  orderDate: Date;
  expectedDeliveryDate: Date;
  actualDeliveryDate?: Date;

  supplierId: string;
  supplierName: string;
  supplierCode: string;

  status:
    | "draft"
    | "sent"
    | "confirmed"
    | "partial"
    | "completed"
    | "cancelled";

  subtotal: number;
  taxAmount: number;
  discountAmount: number;
  shippingCost: number;
  totalAmount: number;

  items: Array<{
    productId: string;
    productName: string;
    productSku: string;
    quantity: number;
    quantityReceived: number;
    unitPrice: number;
    totalPrice: number;
    notes?: string;
  }>;

  delivery: {
    method: "pickup" | "delivery";
    address?: string;
    contactPerson?: string;
    contactPhone?: string;
    specialInstructions?: string;
  };

  terms: {
    paymentTerms: number;
    deliveryTerms: string;
    warranty?: string;
    returnPolicy?: string;
  };
}
```

## üîß **API Endpoints**

### üè≠ **Gesti√≥n de Proveedores:**

#### **Crear Proveedor**

```http
POST /suppliers
Content-Type: application/json

{
  "name": "Distribuidora de Productos de Belleza S.A.S.",
  "type": "distributor",
  "contact": {
    "primaryContact": "Mar√≠a Gonz√°lez",
    "email": "ventas@distribuidorabelleza.com",
    "phone": "+57 1 234 5678",
    "mobile": "+57 300 123 4567",
    "website": "www.distribuidorabelleza.com"
  },
  "address": {
    "street": "Calle 123 #45-67",
    "city": "Bogot√°",
    "state": "Cundinamarca",
    "zipCode": "110111",
    "country": "Colombia"
  },
  "taxInfo": {
    "taxId": "900123456-1",
    "taxName": "Distribuidora de Productos de Belleza S.A.S.",
    "taxExempt": false
  },
  "terms": {
    "paymentTerms": 30,
    "creditLimit": 5000000,
    "currency": "COP",
    "discountPercentage": 5,
    "latePaymentFee": 2
  },
  "banking": {
    "bankName": "Banco de Bogot√°",
    "accountNumber": "1234567890",
    "accountType": "checking"
  },
  "notes": "Proveedor confiable con productos de calidad"
}
```

#### **Obtener Proveedores**

```http
GET /suppliers?businessId=123&status=active&type=distributor&page=1&limit=10&search=distribuidora
```

#### **Obtener Proveedor por ID**

```http
GET /suppliers/{supplierId}
```

#### **Actualizar Proveedor**

```http
PUT /suppliers/{supplierId}
Content-Type: application/json

{
  "rating": 5,
  "notes": "Excelente proveedor, entrega puntual"
}
```

#### **Obtener Productos del Proveedor**

```http
GET /suppliers/{supplierId}/products
```

#### **Obtener Resumen del Proveedor**

```http
GET /suppliers/{supplierId}/summary
```

#### **Suspender Proveedor**

```http
PUT /suppliers/{supplierId}/suspend
Content-Type: application/json

{
  "reason": "Problemas de calidad en productos"
}
```

#### **Reactivar Proveedor**

```http
PUT /suppliers/{supplierId}/activate
```

### üí∞ **Gesti√≥n de Cuentas por Pagar:**

#### **Crear Cuenta por Pagar**

```http
POST /accounts-payable
Content-Type: application/json

{
  "supplierId": "supplierObjectId",
  "invoiceNumber": "FACT-2024-001",
  "invoiceDate": "2024-09-01",
  "dueDate": "2024-10-01",
  "subtotal": 500000,
  "taxAmount": 95000,
  "discountAmount": 25000,
  "totalAmount": 570000,
  "paymentTerms": 30,
  "items": [
    {
      "productName": "Shampoo Profesional",
      "description": "Shampoo para cabello da√±ado 500ml",
      "quantity": 20,
      "unitPrice": 25000,
      "totalPrice": 500000,
      "category": "Productos de cuidado"
    }
  ],
  "notes": "Factura por compra de productos de cuidado"
}
```

#### **Procesar Pago**

```http
POST /accounts-payable/{invoiceId}/pay
Content-Type: application/json

{
  "amount": 300000,
  "paymentMethod": "transfer",
  "paymentReference": "TRF-2024-001"
}
```

#### **Obtener Facturas Vencidas**

```http
GET /accounts-payable/overdue?businessId=123
```

### üìã **Gesti√≥n de √ìrdenes de Compra:**

#### **Crear Orden de Compra**

```http
POST /purchase-orders
Content-Type: application/json

{
  "supplierId": "supplierObjectId",
  "expectedDeliveryDate": "2024-09-15",
  "items": [
    {
      "productId": "productObjectId",
      "quantity": 15,
      "unitPrice": 20000,
      "notes": "Producto para stock"
    }
  ],
  "delivery": {
    "method": "delivery",
    "address": "Calle 100 #15-20, Bogot√°",
    "contactPerson": "Ana Garc√≠a",
    "contactPhone": "+57 300 123 4567"
  },
  "terms": {
    "paymentTerms": 30,
    "deliveryTerms": "FOB"
  }
}
```

#### **Aprobar Orden de Compra**

```http
POST /purchase-orders/{orderId}/approve
```

#### **Confirmar Orden**

```http
POST /purchase-orders/{orderId}/confirm
```

#### **Recibir Productos**

```http
POST /purchase-orders/{orderId}/receive
Content-Type: application/json

{
  "itemsReceived": [
    {
      "productId": "productObjectId",
      "quantity": 15
    }
  ]
}
```

## üí° **Casos de Uso**

### üè≠ **Para Administradores:**

- **Gestionar proveedores** con informaci√≥n completa
- **Configurar costos** por proveedor en productos
- **Aprobar √≥rdenes** de compra
- **Procesar pagos** a proveedores
- **Monitorear cuentas** por pagar

### üì¶ **Para Gerentes de Inventario:**

- **Comparar costos** entre proveedores
- **Crear √≥rdenes** de compra
- **Seguir entregas** de productos
- **Gestionar stock** con m√∫ltiples proveedores

### üí∞ **Para Contadores:**

- **Registrar facturas** de proveedores
- **Procesar pagos** con referencias
- **Generar reportes** de cuentas por pagar
- **Controlar vencimientos**

## üîê **Permisos y Roles**

### üë• **Permisos por Rol:**

| Acci√≥n                      | Super Admin | Admin | Manager | Cashier | Expert | Viewer |
| --------------------------- | ----------- | ----- | ------- | ------- | ------ | ------ |
| **Ver proveedores**         | ‚úÖ          | ‚úÖ    | ‚úÖ      | ‚ùå      | ‚ùå     | ‚úÖ     |
| **Crear proveedores**       | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Actualizar proveedores**  | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Eliminar proveedores**    | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Ver cuentas por pagar**   | ‚úÖ          | ‚úÖ    | ‚úÖ      | ‚ùå      | ‚ùå     | ‚úÖ     |
| **Crear cuentas por pagar** | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Procesar pagos**          | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Ver √≥rdenes de compra**   | ‚úÖ          | ‚úÖ    | ‚úÖ      | ‚ùå      | ‚ùå     | ‚úÖ     |
| **Crear √≥rdenes de compra** | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |
| **Aprobar √≥rdenes**         | ‚úÖ          | ‚úÖ    | ‚ùå      | ‚ùå      | ‚ùå     | ‚ùå     |

## üìä **Reportes y Analytics**

### üìà **Res√∫menes por Proveedor:**

- **Total de facturas** y montos
- **Saldo pendiente** y vencido
- **√ìrdenes de compra** completadas y pendientes
- **Calificaci√≥n** y rendimiento

### üìã **Reportes Generales:**

- **Cuentas por pagar** por vencimiento
- **Proveedores** por tipo y estado
- **√ìrdenes de compra** por estado
- **An√°lisis de costos** por proveedor

### üéØ **M√©tricas Clave:**

- **Tiempo promedio** de pago
- **Proveedores** m√°s utilizados
- **Costos promedio** por categor√≠a
- **Eficiencia** de entregas

## üß™ **Testing y Validaci√≥n**

### ‚úÖ **Scripts de Prueba Incluidos:**

- **test-supplier-system.js** - Pruebas completas del sistema

### üéØ **Escenarios Probados:**

1. **Creaci√≥n de proveedores** con informaci√≥n completa
2. **Actualizaci√≥n de productos** con m√∫ltiples proveedores
3. **Creaci√≥n de cuentas** por pagar
4. **Procesamiento de pagos** parciales
5. **Creaci√≥n de √≥rdenes** de compra
6. **Aprobaci√≥n de √≥rdenes**
7. **Generaci√≥n de res√∫menes**

## üöÄ **Beneficios del Sistema**

### ‚úÖ **Para el Negocio:**

- **Optimizaci√≥n de costos** con m√∫ltiples proveedores
- **Control total** de cuentas por pagar
- **Flujo de aprobaci√≥n** para √≥rdenes de compra
- **Trazabilidad completa** de compras

### ‚úÖ **Para los Proveedores:**

- **Gesti√≥n centralizada** de informaci√≥n
- **T√©rminos comerciales** claros
- **Seguimiento de pagos** en tiempo real
- **Comunicaci√≥n eficiente**

### ‚úÖ **Para el Personal:**

- **Comparaci√≥n f√°cil** de costos
- **Procesamiento autom√°tico** de pagos
- **Alertas de vencimiento**
- **Reportes detallados**

## üîß **Configuraci√≥n y Uso**

### 1Ô∏è‚É£ **Configurar Proveedor:**

```javascript
const supplier = await Supplier.create({
  businessId: businessId,
  name: "Distribuidora de Productos",
  type: "distributor",
  contact: {
    primaryContact: "Mar√≠a Gonz√°lez",
    email: "ventas@distribuidora.com",
    phone: "+57 1 234 5678",
  },
  terms: {
    paymentTerms: 30,
    creditLimit: 5000000,
    currency: "COP",
  },
});
```

### 2Ô∏è‚É£ **Agregar Proveedor a Producto:**

```javascript
const product = await Product.findById(productId);
product.suppliers.push({
  supplierId: supplierId,
  supplierName: "Distribuidora de Productos",
  costPrice: 15000,
  minimumOrder: 10,
  leadTime: 7,
  isPreferred: true,
  isActive: true,
});
await product.save();
```

### 3Ô∏è‚É£ **Crear Cuenta por Pagar:**

```javascript
const accountPayable = await AccountsPayable.create({
  businessId: businessId,
  supplierId: supplierId,
  invoiceNumber: "FACT-2024-001",
  invoiceDate: new Date(),
  dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
  totalAmount: 570000,
  items: [
    /* items */
  ],
});
```

## üöÄ **Estado del Sistema**

**¬°EL SISTEMA DE PROVEEDORES EST√Å COMPLETAMENTE FUNCIONAL!**

- ‚úÖ **Modelo Supplier** con informaci√≥n completa
- ‚úÖ **Modelo Product** actualizado con m√∫ltiples proveedores
- ‚úÖ **Modelo AccountsPayable** para cuentas por pagar
- ‚úÖ **Modelo PurchaseOrder** para √≥rdenes de compra
- ‚úÖ **Controladores completos** con todas las operaciones
- ‚úÖ **Rutas protegidas** con permisos
- ‚úÖ **Validaciones robustas** implementadas
- ‚úÖ **Testing completo** realizado
- ‚úÖ **Documentaci√≥n detallada** disponible

**¬°El sistema est√° listo para manejar proveedores, cuentas por pagar y √≥rdenes de compra de manera completa y eficiente!** üè≠üí∞üìã
